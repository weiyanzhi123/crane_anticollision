## Single merged config for the demo launch:
## - crane_teleop_evdev_with_viz.launch
##
## IMPORTANT:
## These top-level keys MUST match the node names in the launch file, because
## each node reads parameters from its private namespace (~), i.e. /<node_name>/...

crane_teleop_evdev:
  # NOTE:
  # - `device` is machine-specific; launch may override it via an <arg>.
  device: /dev/input/by-id/usb-USB_Keyboard_USB_Keyboard_C108Light00A-event-kbd

  output_topic_a: /crane_teleop/crane_a_states
  output_topic_b: /crane_teleop/crane_b_states
  gear_limit_topic_a: /planner/gear_limit_a
  gear_limit_topic_b: /planner/gear_limit_b

  hz: 50.0

  # Max velocity
  vel_theta_deg_per_sec: 5.0
  vel_r_m_per_sec: 0.5
  vel_z_m_per_sec: 0.3

  # Gear speeds
  slew_gears_deg_per_sec: [0.7, 1.77, 2.66, 3.5]
  trolley_gears_m_per_sec: [0.263, 0.616, 1.036]
  hoist_gears_m_per_sec: [0.0735, 0.182, 0.362, 0.460, 0.604]

  # Acceleration (deg/s^2, m/s^2, m/s^2)
  accel_theta_deg_per_sec2: 10.0
  accel_r_m_per_sec2: 1.0
  accel_z_m_per_sec2: 0.6

  # Deceleration (deg/s^2, m/s^2, m/s^2)
  decel_theta_deg_per_sec2: 15.0
  decel_r_m_per_sec2: 1.5
  decel_z_m_per_sec2: 0.9

  # Initial pose
  init_a_theta_deg: 45.0
  init_a_r: 15.0
  init_a_z: 25.0

  init_b_theta_deg: 235.0
  init_b_r: 22.0
  init_b_z: 6.0

multi_crane_anticollision:
  # Topics
  crane_a_state_topic: /crane_teleop/crane_a_states
  crane_b_state_topic: /crane_teleop/crane_b_states

  # Gear limits (per-axis max gear)
  gear_count_theta: 4
  gear_count_r: 3
  gear_count_z: 5

  # Crane A geometry
  crane_a:
    base_x: 0.0
    base_y: 0.0
    base_z: 0.0
    mast_height: 55.0
    theta_offset_rad: 0.0
    arm_length: 36.6667
    arm_width: 1.0
    arm_thickness: 0.5
    rope_radius: 0.05
    hook_radius: 0.60

  # Crane B geometry
  crane_b:
    base_x: 35.3553
    base_y: 35.3553
    base_z: 0.0
    mast_height: 35.0
    theta_offset_rad: 0.0
    arm_length: 33.3333
    arm_width: 1.0
    arm_thickness: 0.5
    rope_radius: 0.05
    hook_radius: 0.60


  # Thresholds
  D_safe: 10.0
  D_warn: 5.0
  D_stop: 2.0

  # Risk levels
  D_low_risk: 8.0
  D_high_risk: 3.0

  # Prediction
  prediction_time: 2.0
  prediction_step: 0.05
  velocity_window_size: 10.0
  update_hz: 20.0

  # Latency & braking timing
  t_latency: 0.1
  t_brake: 0.5
  t_margin: 0.2

  # Velocity clamp (used for velocity estimation)
  max_theta_dot_rad_per_sec: 0.17453292519943295
  max_r_dot_m_per_sec: 1.0
  max_z_dot_m_per_sec: 0.5

  # Movement speed weights (slew/trolley/hoist)
  speed_weight_slew: 1.0
  speed_weight_trolley: 0.6
  speed_weight_hoist: 0.3

  # Command-fusion (encoder trend) for prediction
  command_fusion_enabled: true
  command_fusion_alpha: 0.6
  command_fusion_lead_time: 0.2

  # Latency compensation & braking-distance guard
  latency_compensation_enabled: true
  latency_compensation_time: 0.15
  braking_distance_guard_enabled: true
  braking_distance_margin: 0.5

  # Priority (strategy 3)
  crane_a_priority: 1.0
  crane_b_priority: 0.5

  # Prediction deceleration (used by core prediction)
  prediction_decel_theta_rad_per_sec2: 0.2617993877991494
  prediction_decel_r_m_per_sec2: 1.5
  prediction_decel_z_m_per_sec2: 0.9

multi_crane_viz:
  use_state_topics: true
  use_gear_limit_topic: true
  world_frame: world
  marker_topic: /crane_anticollision/markers
  viz_hz: 20.0
  enable_crane_c: false
  slew_gears_deg_per_sec: [0.7, 1.77, 2.66, 3.5]
  trolley_gears_m_per_sec: [0.263, 0.616, 1.036]
  hoist_gears_m_per_sec: [0.0735, 0.182, 0.362, 0.460, 0.604]

  crane_a_state_topic: /crane_teleop/crane_a_states
  crane_b_state_topic: /crane_teleop/crane_b_states
  gear_limit_topic: /planner/collision_avoid_info  # backward compatible

  crane_a/use_state_topic: true
  crane_b/use_state_topic: true

  crane_a_frame_prefix: crane_a
  crane_b_frame_prefix: crane_b

  # Static pose (used if a crane is not subscribed to state topics)

  # Stop flash
  stop_red_duration: 1.0
  low_risk_flash_freq: 1.0
  high_risk_flash_freq: 5.0

  # Motion arrows: only show when each component is moving; delete when the component is stationary.
  motion_arrows:
    enabled: true
    theta_vel_threshold_deg_per_sec: 0.05
    r_vel_threshold_m_per_sec: 0.01
    z_vel_threshold_m_per_sec: 0.01
    arm_arrow_length_m: 4.0
    trolley_arrow_length_m: 3.0
    hook_arrow_length_m: 3.0
    shaft_diameter_m: 0.25
    head_diameter_m: 0.45
    head_length_m: 0.7

  crane_a:
    base_x: 0.0
    base_y: 0.0
    base_z: 0.0
    mast_height: 55.0
    mast_radius: 1.2
    arm_length: 36.6667
    arm_width: 1.0
    arm_thickness: 0.5
    counter_arm_length: 8.0
    counter_arm_width: 1.0
    counter_arm_thickness: 0.5
    trolley_length: 1.5
    trolley_width: 1.0
    trolley_height: 0.8
    rope_radius: 0.05
    hook_radius: 0.60
    theta_offset_deg: 0.0


  crane_b:
    base_x: 35.3553
    base_y: 35.3553
    base_z: 0.0
    mast_height: 35.0
    mast_radius: 1.1
    arm_length: 33.3333
    arm_width: 1.0
    arm_thickness: 0.5
    counter_arm_length: 7.3333
    counter_arm_width: 1.0
    counter_arm_thickness: 0.5
    trolley_length: 1.5
    trolley_width: 1.0
    trolley_height: 0.8
    rope_radius: 0.05
    hook_radius: 0.60
    theta_offset_deg: 0.0

